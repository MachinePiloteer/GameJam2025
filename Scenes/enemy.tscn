[gd_scene load_steps=10 format=3 uid="uid://ghy8qs8h8vdd"]

[ext_resource type="Script" uid="uid://35jahqjh4xfr" path="res://Scripts/enemy.gd" id="1_afpow"]
[ext_resource type="Texture2D" uid="uid://b2rsu87ivtgte" path="res://icon.svg" id="1_hghv2"]
[ext_resource type="Script" uid="uid://bdyclqnh8qto5" path="res://Scripts/hurtbox.gd" id="3_0830c"]
[ext_resource type="Script" uid="uid://4jago7ekq5y3" path="res://Scripts/hitbox.gd" id="5_0830c"]

[sub_resource type="CircleShape2D" id="CircleShape2D_afpow"]
radius = 7.0

[sub_resource type="CircleShape2D" id="CircleShape2D_287tu"]
radius = 7.0

[sub_resource type="SkeletonModification2DCCDIK" id="SkeletonModification2DCCDIK_cvnsp"]
target_nodepath = NodePath("../../swordtip")
tip_nodepath = NodePath("upperarm/forearm/sword/swordtip")
ccdik_data_chain_length = 3
joint_data/0/bone_index = 0
joint_data/0/bone2d_node = NodePath("upperarm")
joint_data/0/rotate_from_joint = false
joint_data/0/enable_constraint = false
joint_data/0/editor_draw_gizmo = true
joint_data/1/bone_index = 1
joint_data/1/bone2d_node = NodePath("upperarm/forearm")
joint_data/1/rotate_from_joint = false
joint_data/1/enable_constraint = true
joint_data/1/constraint_angle_min = -140.0
joint_data/1/constraint_angle_max = 0.0
joint_data/1/constraint_angle_invert = true
joint_data/1/constraint_in_localspace = true
joint_data/1/editor_draw_gizmo = true
joint_data/2/bone_index = 2
joint_data/2/bone2d_node = NodePath("upperarm/forearm/sword")
joint_data/2/rotate_from_joint = false
joint_data/2/enable_constraint = true
joint_data/2/constraint_angle_min = -100.0
joint_data/2/constraint_angle_max = -35.0
joint_data/2/constraint_angle_invert = false
joint_data/2/constraint_in_localspace = true
joint_data/2/editor_draw_gizmo = true

[sub_resource type="SkeletonModificationStack2D" id="SkeletonModificationStack2D_6t5aa"]
enabled = true
strength = 0.99
modification_count = 1
modifications/0 = SubResource("SkeletonModification2DCCDIK_cvnsp")

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_0830c"]
radius = 0.999961
height = 31.9986

[node name="enemy" type="CharacterBody2D"]
collision_layer = 2
collision_mask = 3
script = ExtResource("1_afpow")

[node name="enemy_sprite" type="Sprite2D" parent="."]
scale = Vector2(0.125, 0.125)
texture = ExtResource("1_hghv2")

[node name="clash_location" type="Node2D" parent="enemy_sprite"]
position = Vector2(-312, 0)
scale = Vector2(8, 8)

[node name="swordtip_rest" type="Node2D" parent="enemy_sprite"]
position = Vector2(192, 0)
scale = Vector2(8, 8)

[node name="enemy_collision" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_afpow")

[node name="Hurtbox" type="Area2D" parent="."]
collision_layer = 8
script = ExtResource("3_0830c")
metadata/_custom_type_script = "uid://bdyclqnh8qto5"

[node name="enemy_hurtbox_shape" type="CollisionShape2D" parent="Hurtbox"]
shape = SubResource("CircleShape2D_287tu")

[node name="swordtip" type="Node2D" parent="."]
position = Vector2(50, 0)

[node name="spritecontainer" type="Node2D" parent="."]

[node name="upperarm" type="Sprite2D" parent="spritecontainer"]
rotation = 0.444212
scale = Vector2(0.0624951, 0.0312477)
texture = ExtResource("1_hghv2")
offset = Vector2(64, 0)

[node name="forearm" type="Sprite2D" parent="spritecontainer"]
position = Vector2(7.22368, 3.438)
rotation = 0.439629
scale = Vector2(0.0624973, 0.0312486)
texture = ExtResource("1_hghv2")
offset = Vector2(64, 0)

[node name="sword" type="Sprite2D" parent="spritecontainer"]
position = Vector2(14.4632, 6.84288)
rotation = -0.19127
scale = Vector2(0.265834, 0.0156243)
texture = ExtResource("1_hghv2")
offset = Vector2(64, 0)

[node name="bones" type="Node2D" parent="."]

[node name="Skeleton2D" type="Skeleton2D" parent="bones"]
modification_stack = SubResource("SkeletonModificationStack2D_6t5aa")

[node name="upperarm" type="Bone2D" parent="bones/Skeleton2D"]
rotation = 1.22935
scale = Vector2(0.999982, 0.999982)
rest = Transform2D(0.334846, 0.942254, -0.942254, 0.334846, 0, 0)
metadata/_local_pose_override_enabled_ = true

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="bones/Skeleton2D/upperarm"]
remote_path = NodePath("../../../../spritecontainer/upperarm")
update_scale = false

[node name="forearm" type="Bone2D" parent="bones/Skeleton2D/upperarm"]
position = Vector2(8.0002, -1.45435e-05)
rotation = -0.417739
scale = Vector2(0.999991, 0.999991)
rest = Transform2D(0.914001, -0.405691, 0.405691, 0.914001, 8.0002, -1.45435e-05)
metadata/_local_pose_override_enabled_ = true

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="bones/Skeleton2D/upperarm/forearm"]
remote_path = NodePath("../../../../../spritecontainer/forearm")
update_scale = false

[node name="sword" type="Bone2D" parent="bones/Skeleton2D/upperarm/forearm"]
position = Vector2(8.00045, -6.18696e-05)
rotation = -1.313
scale = Vector2(0.999999, 0.999999)
rest = Transform2D(0.25495, -0.966953, 0.966953, 0.25495, 8.00045, -6.18696e-05)
auto_calculate_length_and_angle = false
length = 16.0
bone_angle = 0.0
metadata/_local_pose_override_enabled_ = true

[node name="RemoteTransform2D" type="RemoteTransform2D" parent="bones/Skeleton2D/upperarm/forearm/sword"]
remote_path = NodePath("../../../../../../spritecontainer/sword")
update_scale = false

[node name="swordtip" type="Bone2D" parent="bones/Skeleton2D/upperarm/forearm/sword"]
position = Vector2(34, 0)
rest = Transform2D(1, 0, 0, 1, 34, 0)
auto_calculate_length_and_angle = false
length = 1.0
bone_angle = 0.0

[node name="Hitbox" type="Area2D" parent="bones/Skeleton2D/upperarm/forearm/sword"]
collision_layer = 4
collision_mask = 3
script = ExtResource("5_0830c")
metadata/_custom_type_script = "uid://4jago7ekq5y3"

[node name="enemy_sword_hitbox_area" type="CollisionShape2D" parent="bones/Skeleton2D/upperarm/forearm/sword/Hitbox"]
position = Vector2(17.8657, 0.0817976)
rotation = 1.57079
shape = SubResource("CapsuleShape2D_0830c")

[node name="NavigationAgent2D" type="NavigationAgent2D" parent="."]
path_desired_distance = 3.0
target_desired_distance = 3.0
path_postprocessing = 1

[node name="nav_timer" type="Timer" parent="."]
wait_time = 0.1
one_shot = true
autostart = true

[node name="charge_timer" type="Timer" parent="."]
wait_time = 2.0

[node name="cooldown_timer" type="Timer" parent="."]
wait_time = 1.5

[connection signal="got_hit" from="Hurtbox" to="." method="_on_hurtbox_got_hit"]
[connection signal="clash" from="bones/Skeleton2D/upperarm/forearm/sword/Hitbox" to="." method="_on_hitbox_clash"]
[connection signal="timeout" from="nav_timer" to="." method="_on_nav_timer_timeout"]
[connection signal="timeout" from="nav_timer" to="." method="_on_timer_timeout"]
[connection signal="timeout" from="charge_timer" to="." method="_on_charge_timer_timeout"]
[connection signal="timeout" from="cooldown_timer" to="." method="_on_cooldown_timer_timeout"]
